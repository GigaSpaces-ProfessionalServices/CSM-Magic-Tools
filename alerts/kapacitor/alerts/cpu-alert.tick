dbrp "mydb"."autogen"

var alert_name = 'cpu-alert'

stream
    |from()
        .measurement('os_cpu_used-percent')
    |alert()
        .crit(lambda: int("value") > 15)
        .stateChangesOnly(1d)
		.message('{{ .Vars.alert_name }} on {{ index .Tags "host" }} - {{ .Level }} - {{ .Name }}')
		.details('Process PPID={{ index .Tags "pid" }} on {{ index .Tags "host" }} use {{ index .Fields "value" }} CPU%')
